{"ast":null,"code":"import _objectSpread from\"/Users/lucanest/Desktop/f.nosync/msaviz/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useState,useRef,useEffect,useCallback}from'react';import{parse}from'newick';import{FixedSizeGrid as Grid,FixedSizeList as List}from'react-window';import GridLayout from'react-grid-layout';import'react-grid-layout/css/styles.css';import'react-resizable/css/styles.css';import PhyloTreeViewer from'./components/PhyloTreeViewer.jsx';import Histogram from'./components/Histogram.jsx';import{jsx as _jsx,jsxs as _jsxs,Fragment as _Fragment}from\"react/jsx-runtime\";const residueColors={A:'bg-green-200',C:'bg-yellow-200',D:'bg-red-200',E:'bg-red-200',F:'bg-purple-200',G:'bg-gray-200',H:'bg-pink-200',I:'bg-blue-200',K:'bg-orange-200',L:'bg-blue-200',M:'bg-blue-100',N:'bg-red-100',P:'bg-teal-200',Q:'bg-red-100',R:'bg-orange-300',S:'bg-green-100',T:'bg-green-100',V:'bg-blue-100',W:'bg-purple-300',Y:'bg-purple-100','-':'bg-white'};const AlignmentPanel=/*#__PURE__*/React.memo(function AlignmentPanel(_ref){var _msaData$;let{id,data:{data:msaData,filename},onRemove,onReupload,onLinkClick,isLinkModeActive,isLinked,linkedTo,highlightedSite,highlightOrigin,onHighlight}=_ref;const containerRef=useRef(null);const gridContainerRef=useRef(null);const listRef=useRef(null);const[dims,setDims]=useState({width:0,height:0});const[hoveredCol,setHoveredCol]=useState(null);const[tooltipPos,setTooltipPos]=useState({x:0,y:0});// sizing from your first proposal:\nconst LABEL_WIDTH=96;// px\nconst CELL_SIZE=24;// px\n// Re-measure on panel resize\nuseEffect(()=>{if(!gridContainerRef.current)return;const ro=new ResizeObserver(entries=>{for(let{contentRect}of entries){setDims({width:contentRect.width,height:contentRect.height});}});ro.observe(gridContainerRef.current);// initial measure\nconst{width,height}=gridContainerRef.current.getBoundingClientRect();setDims({width,height});return()=>ro.disconnect();},[]);const rowCount=msaData.length;const colCount=((_msaData$=msaData[0])===null||_msaData$===void 0?void 0:_msaData$.sequence.length)||0;// sync label-list scroll with grid\nconst onScroll=_ref2=>{var _listRef$current;let{scrollTop}=_ref2;(_listRef$current=listRef.current)===null||_listRef$current===void 0?void 0:_listRef$current.scrollTo(scrollTop);};// the Cell renderer now checks for BOTH hover *and* linked-panel highlight:\nconst Cell=useCallback(_ref3=>{let{columnIndex,rowIndex,style}=_ref3;const char=msaData[rowIndex].sequence[columnIndex];const baseBg=residueColors[char.toUpperCase()]||'bg-white';const isHoverHighlight=hoveredCol===columnIndex;// two-way link: if this panel is linked to the origin of the highlight\nconst isLinkedHighlight=highlightedSite===columnIndex&&linkedTo===highlightOrigin;return/*#__PURE__*/_jsx(\"div\",{style:style,className:\"\\n          flex items-center justify-center\\n          \".concat(baseBg,\"\\n          \").concat(isHoverHighlight||isLinkedHighlight?'alignment-highlight':'',\"\\n        \"),onMouseEnter:e=>{setHoveredCol(columnIndex);onHighlight(columnIndex,id);const rect=containerRef.current.getBoundingClientRect();setTooltipPos({x:e.clientX-rect.left,y:e.clientY-rect.top});},onMouseMove:e=>{const rect=containerRef.current.getBoundingClientRect();setTooltipPos({x:e.clientX-rect.left,y:e.clientY-rect.top});},onMouseLeave:()=>{setHoveredCol(null);onHighlight(null,id);},title:\"Pos \".concat(columnIndex+1,\", \").concat(char),children:char});},[msaData,hoveredCol,highlightedSite,highlightOrigin,linkedTo,id,onHighlight]);return/*#__PURE__*/_jsxs(\"div\",{ref:containerRef,className:\"relative flex flex-col h-full border rounded bg-white\",onMouseLeave:()=>{setHoveredCol(null);onHighlight(null,id);},onDoubleClick:()=>onReupload(id),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-drag-handle select-none font-bold text-center bg-gray-100 p-1 mb-2 cursor-move relative\",children:[\"MSA: \",filename,/*#__PURE__*/_jsx(\"button\",{onClick:()=>onRemove(id),className:\"absolute right-10 top-0 text-red-500 hover:text-red-700\",children:\"\\xD7\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>onLinkClick(id),className:\"absolute right-2 top-0 hover:text-blue-700 \".concat(isLinkModeActive?'text-blue-500':isLinked?'text-green-600':'text-gray-400'),title:isLinked?'Unlink panels':'Link this panel',children:\"\\uD83D\\uDD17\"})]}),hoveredCol!==null&&/*#__PURE__*/_jsxs(\"div\",{className:\"fixed px-1 py-0.5 text-xs bg-black text-white rounded pointer-events-none select-none z-50\",style:{top:tooltipPos.y-24,left:tooltipPos.x+4},children:[\"Site \",hoveredCol+1]}),/*#__PURE__*/_jsxs(\"div\",{ref:gridContainerRef,className:\"flex-1 flex overflow-hidden font-mono text-sm\",children:[/*#__PURE__*/_jsx(List,{ref:listRef,height:dims.height,width:LABEL_WIDTH,itemCount:rowCount,itemSize:CELL_SIZE,children:_ref4=>{let{index,style}=_ref4;const seqId=msaData[index].id.replace(/\\s+/g,' ').trim();return/*#__PURE__*/_jsx(\"div\",{style:style,className:\"flex items-center pr-2 pl-2 text-right font-bold truncate bg-white\",title:seqId,children:seqId});}}),/*#__PURE__*/_jsx(Grid,{columnCount:colCount,columnWidth:CELL_SIZE,height:dims.height,rowCount:rowCount,rowHeight:CELL_SIZE,width:Math.max(dims.width-LABEL_WIDTH,0),onScroll:onScroll,children:Cell})]})]});});const TreePanel=/*#__PURE__*/React.memo(function TreePanel(_ref5){let{id,data,onRemove,onReupload,onSelectTip}=_ref5;const{data:newick,filename,isNhx}=data;return/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded overflow-hidden h-full flex flex-col bg-white\",onDoubleClick:()=>onReupload(id),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-drag-handle select-none font-bold text-center bg-gray-100 p-1 mb-2 cursor-move relative\",children:[\"Tree: \",filename,/*#__PURE__*/_jsx(\"button\",{onClick:()=>onRemove(id),className:\"absolute right-2 top-0 text-red-500 hover:text-red-700\",children:\"\\xD7\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-1 overflow-auto flex items-center justify-center\",children:/*#__PURE__*/_jsx(PhyloTreeViewer,{newick:newick,isNhx:isNhx,onSelectTip:onSelectTip})})]});});const HistogramPanel=/*#__PURE__*/React.memo(function HistogramPanel(_ref6){let{id,data,onRemove,onReupload,onLinkClick,isLinkModeActive,isLinked,linkedTo,highlightedSite,highlightOrigin,onHighlight}=_ref6;const{filename}=data;const isTabular=!Array.isArray(data.data);const[selectedCol,setSelectedCol]=useState(isTabular?data.data.headers.find(h=>typeof data.data.rows[0][h]==='number'):null);const numericCols=isTabular?data.data.headers.filter(h=>data.data.rows.every(row=>typeof row[h]==='number')):[];const valuesToPlot=isTabular&&selectedCol?data.data.rows.map(row=>row[selectedCol]):!isTabular?data.data:[];const chartContainerRef=useRef(null);const[height,setHeight]=useState(300);// default height\nuseEffect(()=>{if(!chartContainerRef.current)return;const handleResize=()=>{setHeight(chartContainerRef.current.offsetHeight);};handleResize();const ro=new window.ResizeObserver(handleResize);ro.observe(chartContainerRef.current);return()=>ro.disconnect();},[]);// pass highlight props into Histogram\nreturn/*#__PURE__*/_jsxs(\"div\",{className:\"border rounded overflow-hidden h-full flex flex-col bg-white\",onDoubleClick:()=>onReupload(id),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"panel-drag-handle select-none font-bold text-center bg-gray-100 p-1 mb-2 cursor-move relative\",children:[\"Data: \",filename,/*#__PURE__*/_jsx(\"button\",{onClick:()=>onRemove(id),className:\"absolute right-10 top-0 text-red-500 hover:text-red-700\",children:\"\\xD7\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>onLinkClick(id),className:\"absolute right-2 top-0 hover:text-blue-700 \".concat(isLinkModeActive?'text-blue-500':isLinked?'text-green-600':'text-gray-400'),title:isLinked?'Unlink panels':'Link this panel',children:\"\\uD83D\\uDD17\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"p-2\",children:isTabular&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"label\",{className:\"mr-2\",children:\"Select column:\"}),/*#__PURE__*/_jsx(\"select\",{value:selectedCol,onChange:e=>setSelectedCol(e.target.value),className:\"border rounded p-1\",children:numericCols.map(col=>/*#__PURE__*/_jsx(\"option\",{value:col,children:col},col))})]})}),/*#__PURE__*/_jsx(\"div\",{ref:chartContainerRef,className:\"flex flex-col h-full px-2 pb-2 overflow-hidden\",children:/*#__PURE__*/_jsx(Histogram,{values:valuesToPlot,panelId:id,onHighlight:onHighlight,highlightedSite:highlightedSite,highlightOrigin:highlightOrigin,linkedTo:linkedTo,height:height})})]});});function App(){const[panels,setPanels]=useState([]);const[layout,setLayout]=useState([]);const[selectedId,setSelectedId]=useState(null);const[linkMode,setLinkMode]=useState(null);const[panelLinks,setPanelLinks]=useState({});// { [id]: linkedId }\nconst[highlightSite,setHighlightSite]=useState(null);const[highlightOrigin,setHighlightOrigin]=useState(null);const[panelData,setPanelData]=useState({});const fileInputRef=useRef(null);const pendingTypeRef=useRef(null);const pendingPanelRef=useRef(null);const[windowWidth,setWindowWidth]=useState(window.innerWidth);const[darkMode,setDarkMode]=useState(false);useEffect(()=>{const saved=localStorage.getItem('darkMode');if(saved!==null)setDarkMode(saved==='true');},[]);useEffect(()=>{document.documentElement.classList.toggle('dark',darkMode);localStorage.setItem('darkMode',darkMode);},[darkMode]);useEffect(()=>{const handleResize=()=>setWindowWidth(window.innerWidth);window.addEventListener('resize',handleResize);return()=>window.removeEventListener('resize',handleResize);},[]);const handleLinkClick=id=>{if(!linkMode){// no panel selected yet\nif(panelLinks[id]){// currently linked: unlink both\nconst other=panelLinks[id];setPanelLinks(pl=>{const copy=_objectSpread({},pl);delete copy[id];delete copy[other];return copy;});}else{// start linking\nsetLinkMode(id);}}else{// linking in progress\nif(linkMode===id){// cancelled\nsetLinkMode(null);}else{// link or unlink\nconst a=linkMode;const b=id;if(panelLinks[a]===b){// already linked: unlink\nsetPanelLinks(pl=>{const copy=_objectSpread({},pl);delete copy[a];delete copy[b];return copy;});}else{// create new link: first unlink any existing\nsetPanelLinks(pl=>{const copy=_objectSpread({},pl);if(copy[a]){delete copy[a];delete copy[copy[a]];}if(copy[b]){delete copy[b];delete copy[copy[b]];}copy[a]=b;copy[b]=a;return copy;});}setLinkMode(null);}}// clear any existing highlights\nsetHighlightSite(null);setHighlightOrigin(null);};const handleHighlight=(site,originId)=>{setHighlightSite(site);setHighlightOrigin(originId);};// Trigger upload or reupload\nconst triggerUpload=function(type){let panelId=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;pendingTypeRef.current=type;pendingPanelRef.current=panelId;if(fileInputRef.current)fileInputRef.current.click();};const handleFileUpload=async e=>{const file=e.target.files[0];if(!file)return;const type=pendingTypeRef.current;const isReupload=Boolean(pendingPanelRef.current);const id=isReupload?pendingPanelRef.current:\"\".concat(type,\"-\").concat(Date.now());const filename=file.name;let panelPayload;if(type==='alignment'){const formData=new FormData();formData.append('file',file);const res=await fetch('http://localhost:5001/upload',{method:'POST',body:formData});const data=await res.json();panelPayload={data,filename};}else if(type==='tree'){const text=await file.text();const isNhx=/\\.nhx$/i.test(filename)||text.includes('[&&NHX');parse(text);panelPayload={data:text,filename,isNhx};}else if(type==='histogram'){const text=await file.text();const lines=text.trim().split(/\\r?\\n/);if(filename.toLowerCase().endsWith('.tsv')||lines[0].includes('\\t')){const headers=lines[0].split('\\t').map(h=>h.trim());const rows=lines.slice(1).map(line=>{const cols=line.split('\\t');const obj={};headers.forEach((h,i)=>{var _cols$i;const v=(_cols$i=cols[i])===null||_cols$i===void 0?void 0:_cols$i.trim();const n=Number(v);obj[h]=isNaN(n)?v:n;});return obj;});panelPayload={data:{headers,rows},filename};}else{const values=text.trim().split(/\\s+/).map(Number).filter(n=>!isNaN(n));panelPayload={data:values,filename};}}// Update or add panel data\nsetPanelData(prev=>_objectSpread(_objectSpread({},prev),{},{[id]:panelPayload}));if(!isReupload){// Add new panel in layout\nsetPanels(prev=>{const withoutFooter=prev.filter(p=>p.i!=='__footer');return[...withoutFooter,{i:id,type},{i:'__footer',type:'footer'}];});const layoutWithoutFooter=layout.filter(l=>l.i!=='__footer');const maxY=layoutWithoutFooter.reduce((max,l)=>Math.max(max,l.y+l.h),0);const newPanelLayout={i:id,x:layoutWithoutFooter.length*4%12,y:maxY,w:4,h:20,minW:3,minH:5};setLayout([...layoutWithoutFooter,newPanelLayout,{i:'__footer',x:0,y:maxY+1,w:12,h:2,static:true}]);}// Reset input\npendingTypeRef.current=null;pendingPanelRef.current=null;if(fileInputRef.current)fileInputRef.current.value=null;};const removePanel=id=>{if(id==='__footer')return;setPanels(p=>p.filter(panel=>panel.i!==id));setPanelData(d=>{const c=_objectSpread({},d);delete c[id];return c;});setLayout(l=>l.filter(entry=>entry.i!==id));};return/*#__PURE__*/_jsxs(\"div\",{className:\"h-screen w-screen flex flex-col overflow-hidden bg-white text-black dark:bg-gray-900 dark:text-black\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"p-4 flex justify-between items-center\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-start w-full\",children:'MSEAVIEW'.split('').map((char,i)=>/*#__PURE__*/_jsx(\"span\",{className:\"w-16 h-16 flex items-center justify-center text-5xl font-bold leading-none \".concat(residueColors[char],\" \"),children:char},i))}),/*#__PURE__*/_jsxs(\"div\",{className:\"flex items-center gap-4\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>triggerUpload('alignment'),className:\"bg-green-200 text-black px-4 py-2 rounded hover:bg-green-400\",children:\"Upload MSA (.fasta)\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>triggerUpload('tree'),className:\"bg-blue-200 text-black px-4 py-2 rounded hover:bg-blue-400\",children:\"Upload Tree (.nwk/.nhx)\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>triggerUpload('histogram'),className:\"bg-orange-200 text-black px-4 py-2 rounded hover:bg-orange-400\",children:\"Upload data (.txt/.tsv)\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setDarkMode(prev=>!prev),className:\"bg-gray-800 text-white px-2 py-1 rounded hover:bg-gray-700 dark:bg-white dark:text-black dark:hover:bg-gray-300\",children:darkMode?'â˜€ï¸Ž':'â˜¾'}),/*#__PURE__*/_jsx(\"input\",{ref:fileInputRef,type:\"file\",accept:\".fasta,.nwk,.nhx,.txt,.tsv,.fas\",onChange:handleFileUpload,style:{display:'none'}})]})]}),panels.length>0&&/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow overflow-auto pb-20\",children:/*#__PURE__*/_jsx(GridLayout,{className:\"layout\",layout:layout,cols:12,rowHeight:30,width:windowWidth,autoSize:false,isResizable:true,isDraggable:true,margin:[10,10],containerPadding:[10,10],draggableHandle:\".panel-drag-handle\",draggableCancel:\"select, option, input, textarea, button\",onLayoutChange:newLayout=>{const footer=newLayout.find(l=>l.i==='__footer');const others=newLayout.filter(l=>l.i!=='__footer');const maxY=others.reduce((max,l)=>Math.max(max,l.y+l.h),0);const fixedFooter=_objectSpread(_objectSpread({},footer),{},{y:maxY});setLayout([...others,fixedFooter]);},children:panels.map(panel=>{if(panel.i==='__footer'){return/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center justify-center text-gray-500 dark:text-gray-400 text-sm\"},\"__footer\");}const data=panelData[panel.i];if(!data)return null;const commonProps={id:panel.i,data,onRemove:removePanel,onReupload:id=>triggerUpload(panel.type,id),onLinkClick:handleLinkClick,isLinkModeActive:linkMode===panel.i,isLinked:!!panelLinks[panel.i],linkedTo:panelLinks[panel.i]||null,highlightedSite:highlightSite,highlightOrigin:highlightOrigin,onHighlight:handleHighlight};return/*#__PURE__*/_jsx(\"div\",{children:panel.type==='alignment'?/*#__PURE__*/_jsx(AlignmentPanel,_objectSpread(_objectSpread({},commonProps),{},{selectedId:selectedId})):panel.type==='tree'?/*#__PURE__*/_jsx(TreePanel,_objectSpread(_objectSpread({},commonProps),{},{onSelectTip:setSelectedId})):/*#__PURE__*/_jsx(HistogramPanel,_objectSpread({},commonProps))},panel.i);})})})]});}export default App;","map":{"version":3,"names":["React","useState","useRef","useEffect","useCallback","parse","FixedSizeGrid","Grid","FixedSizeList","List","GridLayout","PhyloTreeViewer","Histogram","jsx","_jsx","jsxs","_jsxs","Fragment","_Fragment","residueColors","A","C","D","E","F","G","H","I","K","L","M","N","P","Q","R","S","T","V","W","Y","AlignmentPanel","memo","_ref","_msaData$","id","data","msaData","filename","onRemove","onReupload","onLinkClick","isLinkModeActive","isLinked","linkedTo","highlightedSite","highlightOrigin","onHighlight","containerRef","gridContainerRef","listRef","dims","setDims","width","height","hoveredCol","setHoveredCol","tooltipPos","setTooltipPos","x","y","LABEL_WIDTH","CELL_SIZE","current","ro","ResizeObserver","entries","contentRect","observe","getBoundingClientRect","disconnect","rowCount","length","colCount","sequence","onScroll","_ref2","_listRef$current","scrollTop","scrollTo","Cell","_ref3","columnIndex","rowIndex","style","char","baseBg","toUpperCase","isHoverHighlight","isLinkedHighlight","className","concat","onMouseEnter","e","rect","clientX","left","clientY","top","onMouseMove","onMouseLeave","title","children","ref","onDoubleClick","onClick","itemCount","itemSize","_ref4","index","seqId","replace","trim","columnCount","columnWidth","rowHeight","Math","max","TreePanel","_ref5","onSelectTip","newick","isNhx","HistogramPanel","_ref6","isTabular","Array","isArray","selectedCol","setSelectedCol","headers","find","h","rows","numericCols","filter","every","row","valuesToPlot","map","chartContainerRef","setHeight","handleResize","offsetHeight","window","value","onChange","target","col","values","panelId","App","panels","setPanels","layout","setLayout","selectedId","setSelectedId","linkMode","setLinkMode","panelLinks","setPanelLinks","highlightSite","setHighlightSite","setHighlightOrigin","panelData","setPanelData","fileInputRef","pendingTypeRef","pendingPanelRef","windowWidth","setWindowWidth","innerWidth","darkMode","setDarkMode","saved","localStorage","getItem","document","documentElement","classList","toggle","setItem","addEventListener","removeEventListener","handleLinkClick","other","pl","copy","_objectSpread","a","b","handleHighlight","site","originId","triggerUpload","type","arguments","undefined","click","handleFileUpload","file","files","isReupload","Boolean","Date","now","name","panelPayload","formData","FormData","append","res","fetch","method","body","json","text","test","includes","lines","split","toLowerCase","endsWith","slice","line","cols","obj","forEach","i","_cols$i","v","n","Number","isNaN","prev","withoutFooter","p","layoutWithoutFooter","l","maxY","reduce","newPanelLayout","w","minW","minH","static","removePanel","panel","d","c","entry","accept","display","autoSize","isResizable","isDraggable","margin","containerPadding","draggableHandle","draggableCancel","onLayoutChange","newLayout","footer","others","fixedFooter","commonProps"],"sources":["/Users/lucanest/Desktop/f.nosync/msaviz/frontend/src/App.jsx"],"sourcesContent":["import React, { useState, useRef, useEffect, useCallback } from 'react';\nimport { parse } from 'newick';\nimport { FixedSizeGrid as Grid, FixedSizeList as List } from 'react-window';\nimport GridLayout from 'react-grid-layout';\nimport 'react-grid-layout/css/styles.css';\nimport 'react-resizable/css/styles.css';\n\nimport PhyloTreeViewer from './components/PhyloTreeViewer.jsx';\nimport Histogram from './components/Histogram.jsx';\n\nconst residueColors = {\n  A: 'bg-green-200', C: 'bg-yellow-200', D: 'bg-red-200', E: 'bg-red-200',\n  F: 'bg-purple-200', G: 'bg-gray-200', H: 'bg-pink-200', I: 'bg-blue-200',\n  K: 'bg-orange-200', L: 'bg-blue-200', M: 'bg-blue-100', N: 'bg-red-100',\n  P: 'bg-teal-200', Q: 'bg-red-100', R: 'bg-orange-300', S: 'bg-green-100',\n  T: 'bg-green-100', V: 'bg-blue-100', W: 'bg-purple-300', Y: 'bg-purple-100',\n  '-': 'bg-white'\n};\n\nconst AlignmentPanel = React.memo(function AlignmentPanel({\n  id,\n  data: { data: msaData, filename },\n  onRemove, onReupload,\n  onLinkClick, isLinkModeActive, isLinked, linkedTo,\n  highlightedSite, highlightOrigin, onHighlight\n}) {\n  const containerRef     = useRef(null);\n  const gridContainerRef = useRef(null);\n  const listRef          = useRef(null);\n\n  const [dims, setDims]           = useState({ width: 0, height: 0 });\n  const [hoveredCol, setHoveredCol] = useState(null);\n  const [tooltipPos, setTooltipPos]   = useState({ x: 0, y: 0 });\n\n  // sizing from your first proposal:\n  const LABEL_WIDTH = 96;  // px\n  const CELL_SIZE   = 24;  // px\n\n  // Re-measure on panel resize\n  useEffect(() => {\n    if (!gridContainerRef.current) return;\n    const ro = new ResizeObserver(entries => {\n      for (let { contentRect } of entries) {\n        setDims({\n          width:  contentRect.width,\n          height: contentRect.height\n        });\n      }\n    });\n    ro.observe(gridContainerRef.current);\n    // initial measure\n    const { width, height } = gridContainerRef.current.getBoundingClientRect();\n    setDims({ width, height });\n    return () => ro.disconnect();\n  }, []);\n\n  const rowCount = msaData.length;\n  const colCount = msaData[0]?.sequence.length || 0;\n\n  // sync label-list scroll with grid\n  const onScroll = ({ scrollTop }) => {\n    listRef.current?.scrollTo(scrollTop);\n  };\n\n  // the Cell renderer now checks for BOTH hover *and* linked-panel highlight:\n  const Cell = useCallback(({ columnIndex, rowIndex, style }) => {\n    const char   = msaData[rowIndex].sequence[columnIndex];\n    const baseBg = residueColors[char.toUpperCase()] || 'bg-white';\n    const isHoverHighlight  = hoveredCol === columnIndex;\n    // two-way link: if this panel is linked to the origin of the highlight\n    const isLinkedHighlight = \n      highlightedSite === columnIndex &&\n      linkedTo === highlightOrigin;\n\n    return (\n      <div\n        style={style}\n        className={`\n          flex items-center justify-center\n          ${baseBg}\n          ${isHoverHighlight || isLinkedHighlight ? 'alignment-highlight' : ''}\n        `}\n        onMouseEnter={e => {\n          setHoveredCol(columnIndex);\n          onHighlight(columnIndex, id);\n          const rect = containerRef.current.getBoundingClientRect();\n          setTooltipPos({ x: e.clientX - rect.left, y: e.clientY - rect.top });\n        }}\n        onMouseMove={e => {\n          const rect = containerRef.current.getBoundingClientRect();\n          setTooltipPos({ x: e.clientX - rect.left, y: e.clientY - rect.top });\n        }}\n        onMouseLeave={() => {\n          setHoveredCol(null);\n          onHighlight(null, id);\n        }}\n        title={`Pos ${columnIndex + 1}, ${char}`}\n      >\n        {char}\n      </div>\n    );\n  }, [\n    msaData, hoveredCol,\n    highlightedSite, highlightOrigin,\n    linkedTo, id, onHighlight\n  ]);\n\n  return (\n    <div\n      ref={containerRef}\n      className=\"relative flex flex-col h-full border rounded bg-white\"\n      onMouseLeave={() => {\n        setHoveredCol(null);\n        onHighlight(null, id);\n      }}\n      onDoubleClick={() => onReupload(id)}\n    >\n      {/* header */}\n      <div className=\"panel-drag-handle select-none font-bold text-center bg-gray-100 p-1 mb-2 cursor-move relative\">\n        MSA: {filename}\n        <button\n          onClick={() => onRemove(id)}\n          className=\"absolute right-10 top-0 text-red-500 hover:text-red-700\"\n        >Ã—</button>\n        <button\n          onClick={() => onLinkClick(id)}\n          className={`absolute right-2 top-0 hover:text-blue-700 ${\n            isLinkModeActive ? 'text-blue-500' :\n            isLinked       ? 'text-green-600' :\n                              'text-gray-400'\n          }`}\n          title={isLinked ? 'Unlink panels' : 'Link this panel'}\n        >ðŸ”—</button>\n      </div>\n\n      {/* tooltip */}\n      {hoveredCol !== null && (\n        <div\n          className=\"fixed px-1 py-0.5 text-xs bg-black text-white rounded pointer-events-none select-none z-50\"\n          style={{ top: tooltipPos.y - 24, left: tooltipPos.x + 4 }}\n        >\n          Site {hoveredCol + 1}\n        </div>\n      )}\n\n      {/* labels + virtualized grid */}\n      <div\n        ref={gridContainerRef}\n        className=\"flex-1 flex overflow-hidden font-mono text-sm\"\n      >\n        {/* sequence IDs */}\n        <List\n          ref={listRef}\n          height={dims.height}\n          width={LABEL_WIDTH}\n          itemCount={rowCount}\n          itemSize={CELL_SIZE}\n        >\n          {({ index, style }) => {\n            const seqId = msaData[index].id.replace(/\\s+/g, ' ').trim();\n            return (\n              <div\n                style={style}\n                className=\"flex items-center pr-2 pl-2 text-right font-bold truncate bg-white\"\n                title={seqId}\n              >\n                {seqId}\n              </div>\n            );\n          }}\n        </List>\n\n        {/* the alignment */}\n        <Grid\n          columnCount={colCount}\n          columnWidth={CELL_SIZE}\n          height={dims.height}\n          rowCount={rowCount}\n          rowHeight={CELL_SIZE}\n          width={Math.max(dims.width - LABEL_WIDTH, 0)}\n          onScroll={onScroll}\n        >\n          {Cell}\n        </Grid>\n      </div>\n    </div>\n  );\n});\n\nconst TreePanel = React.memo(function TreePanel({ id, data, onRemove, onReupload, onSelectTip }) {\n  const { data: newick, filename, isNhx } = data;\n\n  return (\n    <div\n      className=\"border rounded overflow-hidden h-full flex flex-col bg-white\"\n      onDoubleClick={() => onReupload(id)}\n    >\n      <div className=\"panel-drag-handle select-none font-bold text-center bg-gray-100 p-1 mb-2 cursor-move relative\">\n        Tree: {filename}\n        <button\n          onClick={() => onRemove(id)}\n          className=\"absolute right-2 top-0 text-red-500 hover:text-red-700\"\n        >\n          Ã—\n        </button>\n      </div>\n      <div className=\"flex-1 overflow-auto flex items-center justify-center\">\n        <PhyloTreeViewer newick={newick} isNhx={isNhx} onSelectTip={onSelectTip} />\n      </div>\n    </div>\n  );\n});\n\n\nconst HistogramPanel = React.memo(function HistogramPanel({ id, data, onRemove, onReupload,\n  onLinkClick, isLinkModeActive, isLinked, linkedTo,\n  highlightedSite, highlightOrigin, onHighlight }) {\n  const { filename } = data;\n  const isTabular = !Array.isArray(data.data);\n  const [selectedCol, setSelectedCol] = useState(\n    isTabular ? data.data.headers.find(h => typeof data.data.rows[0][h] === 'number') : null\n  );\n  const numericCols = isTabular\n    ? data.data.headers.filter(h =>\n        data.data.rows.every(row => typeof row[h] === 'number')\n      )\n    : [];\n  const valuesToPlot = isTabular && selectedCol\n    ? data.data.rows.map(row => row[selectedCol])\n    : !isTabular\n      ? data.data\n      : [];\n\n  const chartContainerRef = useRef(null);\n  const [height, setHeight] = useState(300); // default height\n\n  useEffect(() => {\n    if (!chartContainerRef.current) return;\n    const handleResize = () => {\n      setHeight(chartContainerRef.current.offsetHeight);\n    };\n    handleResize();\n    const ro = new window.ResizeObserver(handleResize);\n    ro.observe(chartContainerRef.current);\n    return () => ro.disconnect();\n  }, []);\n// pass highlight props into Histogram\n  return (\n    <div\n      className=\"border rounded overflow-hidden h-full flex flex-col bg-white\"\n      onDoubleClick={() => onReupload(id)}\n    >\n      <div className=\"panel-drag-handle select-none font-bold text-center bg-gray-100 p-1 mb-2 cursor-move relative\">\n        Data: {filename}\n        <button\n          onClick={() => onRemove(id)}\n          className=\"absolute right-10 top-0 text-red-500 hover:text-red-700\"\n        >\n          Ã—\n        </button>\n        <button\n          onClick={() => onLinkClick(id)}\n          className={`absolute right-2 top-0 hover:text-blue-700 ${isLinkModeActive ? 'text-blue-500' : isLinked ? 'text-green-600' : 'text-gray-400'}`}\n          title={isLinked ? 'Unlink panels' : 'Link this panel'}\n        >\n          ðŸ”—\n        </button>\n      </div>\n      <div className=\"p-2\">\n        {isTabular && (\n          <>\n            <label className=\"mr-2\">Select column:</label>\n            <select\n              value={selectedCol}\n              onChange={e => setSelectedCol(e.target.value)}\n              className=\"border rounded p-1\"\n            >\n              {numericCols.map(col => (\n                <option key={col} value={col}>{col}</option>\n              ))}\n            </select>\n          </>\n        )}\n      </div>\n      <div ref={chartContainerRef} className=\"flex flex-col h-full px-2 pb-2 overflow-hidden\">\n  <Histogram\n    values={valuesToPlot}\n    panelId={id}\n    onHighlight={onHighlight}\n    highlightedSite={highlightedSite}\n    highlightOrigin={highlightOrigin}\n    linkedTo={linkedTo}\n    height={height}\n  />\n</div>\n    </div>\n  );\n});\n\nfunction App() {\n  const [panels, setPanels] = useState([]);\n  const [layout, setLayout] = useState([]);\n  const [selectedId, setSelectedId] = useState(null);\n  const [linkMode, setLinkMode] = useState(null);\n  const [panelLinks, setPanelLinks] = useState({}); // { [id]: linkedId }\n  const [highlightSite, setHighlightSite] = useState(null);\n  const [highlightOrigin, setHighlightOrigin] = useState(null);\n  const [panelData, setPanelData] = useState({});\n  const fileInputRef = useRef(null);\n  const pendingTypeRef = useRef(null);\n  const pendingPanelRef = useRef(null);\n  const [windowWidth, setWindowWidth] = useState(window.innerWidth);\n  const [darkMode, setDarkMode] = useState(false);\n\n  useEffect(() => {\n    const saved = localStorage.getItem('darkMode');\n    if (saved !== null) setDarkMode(saved === 'true');\n  }, []);\n\n  useEffect(() => {\n    document.documentElement.classList.toggle('dark', darkMode);\n    localStorage.setItem('darkMode', darkMode);\n  }, [darkMode]);\n\n  useEffect(() => {\n    const handleResize = () => setWindowWidth(window.innerWidth);\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n\n  const handleLinkClick = (id) => {\n    if (!linkMode) {\n      // no panel selected yet\n      if (panelLinks[id]) {\n        // currently linked: unlink both\n        const other = panelLinks[id];\n        setPanelLinks(pl => {\n          const copy = { ...pl };\n          delete copy[id]; delete copy[other];\n          return copy;\n        });\n      } else {\n        // start linking\n        setLinkMode(id);\n      }\n    } else {\n      // linking in progress\n      if (linkMode === id) {\n        // cancelled\n        setLinkMode(null);\n      } else {\n        // link or unlink\n        const a = linkMode;\n        const b = id;\n        if (panelLinks[a] === b) {\n          // already linked: unlink\n          setPanelLinks(pl => {\n            const copy = { ...pl };\n            delete copy[a]; delete copy[b];\n            return copy;\n          });\n        } else {\n          // create new link: first unlink any existing\n          setPanelLinks(pl => {\n            const copy = { ...pl };\n            if (copy[a]) { delete copy[a]; delete copy[copy[a]]; }\n            if (copy[b]) { delete copy[b]; delete copy[copy[b]]; }\n            copy[a] = b;\n            copy[b] = a;\n            return copy;\n          });\n        }\n        setLinkMode(null);\n      }\n    }\n    // clear any existing highlights\n    setHighlightSite(null);\n    setHighlightOrigin(null);\n  };\n\n  const handleHighlight = (site, originId) => {\n    setHighlightSite(site);\n    setHighlightOrigin(originId);\n  };\n\n\n  // Trigger upload or reupload\n  const triggerUpload = (type, panelId = null) => {\n    pendingTypeRef.current = type;\n    pendingPanelRef.current = panelId;\n    if (fileInputRef.current) fileInputRef.current.click();\n  };\n\n  const handleFileUpload = async (e) => {\n    const file = e.target.files[0];\n    if (!file) return;\n\n    const type = pendingTypeRef.current;\n    const isReupload = Boolean(pendingPanelRef.current);\n    const id = isReupload ? pendingPanelRef.current : `${type}-${Date.now()}`;\n    const filename = file.name;\n\n    let panelPayload;\n    if (type === 'alignment') {\n      const formData = new FormData();\n      formData.append('file', file);\n      const res = await fetch('http://localhost:5001/upload', { method: 'POST', body: formData });\n      const data = await res.json();\n      panelPayload = { data, filename };\n    } else if (type === 'tree') {\n      const text = await file.text();\n      const isNhx = /\\.nhx$/i.test(filename) || text.includes('[&&NHX');\n      parse(text);\n      panelPayload = { data: text, filename, isNhx };\n    } else if (type === 'histogram') {\n      const text = await file.text();\n      const lines = text.trim().split(/\\r?\\n/);\n      if (filename.toLowerCase().endsWith('.tsv') || lines[0].includes('\\t')) {\n        const headers = lines[0].split('\\t').map(h => h.trim());\n        const rows = lines.slice(1).map(line => {\n          const cols = line.split('\\t');\n          const obj = {};\n          headers.forEach((h, i) => {\n            const v = cols[i]?.trim();\n            const n = Number(v);\n            obj[h] = isNaN(n) ? v : n;\n          });\n          return obj;\n        });\n        panelPayload = { data: { headers, rows }, filename };\n      } else {\n        const values = text.trim().split(/\\s+/).map(Number).filter(n => !isNaN(n));\n        panelPayload = { data: values, filename };\n      }\n    }\n\n    // Update or add panel data\n    setPanelData(prev => ({ ...prev, [id]: panelPayload }));\n\n    if (!isReupload) {\n      // Add new panel in layout\n      setPanels(prev => {\n        const withoutFooter = prev.filter(p => p.i !== '__footer');\n        return [\n          ...withoutFooter,\n          { i: id, type },\n          { i: '__footer', type: 'footer' }\n        ];\n      });\n      const layoutWithoutFooter = layout.filter(l => l.i !== '__footer');\n      const maxY = layoutWithoutFooter.reduce((max, l) => Math.max(max, l.y + l.h), 0);\n      const newPanelLayout = { i: id, x: (layoutWithoutFooter.length * 4) % 12, y: maxY, w: 4, h: 20, minW: 3, minH: 5 };\n      setLayout([...layoutWithoutFooter, newPanelLayout, { i: '__footer', x: 0, y: maxY + 1, w: 12, h: 2, static: true }]);\n    }\n\n    // Reset input\n    pendingTypeRef.current = null;\n    pendingPanelRef.current = null;\n    if (fileInputRef.current) fileInputRef.current.value = null;\n  };\n\n  const removePanel = (id) => {\n    if (id === '__footer') return;\n    setPanels(p => p.filter(panel => panel.i !== id));\n    setPanelData(d => { const c = { ...d }; delete c[id]; return c; });\n    setLayout(l => l.filter(entry => entry.i !== id));\n  };\n\n  return (\n    <div className=\"h-screen w-screen flex flex-col overflow-hidden bg-white text-black dark:bg-gray-900 dark:text-black\">\n      <div className=\"p-4 flex justify-between items-center\">\n        <div className=\"flex items-center justify-start w-full\">\n          {'MSEAVIEW'.split('').map((char, i) => (\n            <span key={i} className={`w-16 h-16 flex items-center justify-center text-5xl font-bold leading-none ${residueColors[char]} `}>{char}</span>\n          ))}\n        </div>\n        <div className=\"flex items-center gap-4\">\n          <button onClick={() => triggerUpload('alignment')} className=\"bg-green-200 text-black px-4 py-2 rounded hover:bg-green-400\">\n            Upload MSA (.fasta)\n          </button>\n          <button onClick={() => triggerUpload('tree')} className=\"bg-blue-200 text-black px-4 py-2 rounded hover:bg-blue-400\">\n            Upload Tree (.nwk/.nhx)\n          </button>\n          <button onClick={() => triggerUpload('histogram')} className=\"bg-orange-200 text-black px-4 py-2 rounded hover:bg-orange-400\">\n            Upload data (.txt/.tsv)\n          </button>\n          <button onClick={() => setDarkMode(prev => !prev)} className=\"bg-gray-800 text-white px-2 py-1 rounded hover:bg-gray-700 dark:bg-white dark:text-black dark:hover:bg-gray-300\">\n            {darkMode ? 'â˜€ï¸Ž' : 'â˜¾'}\n          </button>\n          <input ref={fileInputRef} type=\"file\" accept=\".fasta,.nwk,.nhx,.txt,.tsv,.fas\" onChange={handleFileUpload} style={{ display: 'none' }} />\n        </div>\n      </div>\n\n      {panels.length > 0 && (\n        <div className=\"flex-grow overflow-auto pb-20\">\n          <GridLayout\n            className=\"layout\"\n            layout={layout}\n            cols={12}\n            rowHeight={30}\n            width={windowWidth}\n            autoSize={false}\n            isResizable\n            isDraggable\n            margin={[10, 10]}\n            containerPadding={[10, 10]}\n            draggableHandle=\".panel-drag-handle\"\n            draggableCancel=\"select, option, input, textarea, button\"\n            onLayoutChange={(newLayout) => {\n              const footer = newLayout.find(l => l.i === '__footer');\n              const others = newLayout.filter(l => l.i !== '__footer');\n              const maxY = others.reduce((max, l) => Math.max(max, l.y + l.h), 0);\n              const fixedFooter = { ...footer, y: maxY };\n              setLayout([...others, fixedFooter]);\n            }}\n          >\n{panels.map(panel => {\n  if (panel.i === '__footer') {\n    return (\n      <div key=\"__footer\" className=\"flex items-center justify-center text-gray-500 dark:text-gray-400 text-sm\" />\n    );\n  }\n  const data = panelData[panel.i];\n  if (!data) return null;\n\n  const commonProps = {\n    id: panel.i,\n    data,\n    onRemove: removePanel,\n    onReupload: id => triggerUpload(panel.type, id),\n\n    onLinkClick: handleLinkClick,\n    isLinkModeActive: linkMode === panel.i,\n    isLinked: !!panelLinks[panel.i],\n    linkedTo: panelLinks[panel.i] || null,\n\n    highlightedSite: highlightSite,\n    highlightOrigin: highlightOrigin,\n    onHighlight: handleHighlight,\n  };\n\n  return (\n    <div key={panel.i}>\n      {panel.type === 'alignment' ? (\n        <AlignmentPanel\n          {...commonProps}\n          selectedId={selectedId}\n        />\n      ) : panel.type === 'tree' ? (\n        <TreePanel\n          {...commonProps}\n          onSelectTip={setSelectedId}\n        />\n      ) : (\n        <HistogramPanel\n          {...commonProps}\n        />\n      )}\n    </div>\n  );\n})}\n          </GridLayout>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default App;\n"],"mappings":"qIAAA,MAAO,CAAAA,KAAK,EAAIC,QAAQ,CAAEC,MAAM,CAAEC,SAAS,CAAEC,WAAW,KAAQ,OAAO,CACvE,OAASC,KAAK,KAAQ,QAAQ,CAC9B,OAASC,aAAa,GAAI,CAAAC,IAAI,CAAEC,aAAa,GAAI,CAAAC,IAAI,KAAQ,cAAc,CAC3E,MAAO,CAAAC,UAAU,KAAM,mBAAmB,CAC1C,MAAO,kCAAkC,CACzC,MAAO,gCAAgC,CAEvC,MAAO,CAAAC,eAAe,KAAM,kCAAkC,CAC9D,MAAO,CAAAC,SAAS,KAAM,4BAA4B,CAAC,OAAAC,GAAA,IAAAC,IAAA,CAAAC,IAAA,IAAAC,KAAA,CAAAC,QAAA,IAAAC,SAAA,yBAEnD,KAAM,CAAAC,aAAa,CAAG,CACpBC,CAAC,CAAE,cAAc,CAAEC,CAAC,CAAE,eAAe,CAAEC,CAAC,CAAE,YAAY,CAAEC,CAAC,CAAE,YAAY,CACvEC,CAAC,CAAE,eAAe,CAAEC,CAAC,CAAE,aAAa,CAAEC,CAAC,CAAE,aAAa,CAAEC,CAAC,CAAE,aAAa,CACxEC,CAAC,CAAE,eAAe,CAAEC,CAAC,CAAE,aAAa,CAAEC,CAAC,CAAE,aAAa,CAAEC,CAAC,CAAE,YAAY,CACvEC,CAAC,CAAE,aAAa,CAAEC,CAAC,CAAE,YAAY,CAAEC,CAAC,CAAE,eAAe,CAAEC,CAAC,CAAE,cAAc,CACxEC,CAAC,CAAE,cAAc,CAAEC,CAAC,CAAE,aAAa,CAAEC,CAAC,CAAE,eAAe,CAAEC,CAAC,CAAE,eAAe,CAC3E,GAAG,CAAE,UACP,CAAC,CAED,KAAM,CAAAC,cAAc,cAAGxC,KAAK,CAACyC,IAAI,CAAC,QAAS,CAAAD,cAAcA,CAAAE,IAAA,CAMtD,KAAAC,SAAA,IANuD,CACxDC,EAAE,CACFC,IAAI,CAAE,CAAEA,IAAI,CAAEC,OAAO,CAAEC,QAAS,CAAC,CACjCC,QAAQ,CAAEC,UAAU,CACpBC,WAAW,CAAEC,gBAAgB,CAAEC,QAAQ,CAAEC,QAAQ,CACjDC,eAAe,CAAEC,eAAe,CAAEC,WACpC,CAAC,CAAAd,IAAA,CACC,KAAM,CAAAe,YAAY,CAAOvD,MAAM,CAAC,IAAI,CAAC,CACrC,KAAM,CAAAwD,gBAAgB,CAAGxD,MAAM,CAAC,IAAI,CAAC,CACrC,KAAM,CAAAyD,OAAO,CAAYzD,MAAM,CAAC,IAAI,CAAC,CAErC,KAAM,CAAC0D,IAAI,CAAEC,OAAO,CAAC,CAAa5D,QAAQ,CAAC,CAAE6D,KAAK,CAAE,CAAC,CAAEC,MAAM,CAAE,CAAE,CAAC,CAAC,CACnE,KAAM,CAACC,UAAU,CAAEC,aAAa,CAAC,CAAGhE,QAAQ,CAAC,IAAI,CAAC,CAClD,KAAM,CAACiE,UAAU,CAAEC,aAAa,CAAC,CAAKlE,QAAQ,CAAC,CAAEmE,CAAC,CAAE,CAAC,CAAEC,CAAC,CAAE,CAAE,CAAC,CAAC,CAE9D;AACA,KAAM,CAAAC,WAAW,CAAG,EAAE,CAAG;AACzB,KAAM,CAAAC,SAAS,CAAK,EAAE,CAAG;AAEzB;AACApE,SAAS,CAAC,IAAM,CACd,GAAI,CAACuD,gBAAgB,CAACc,OAAO,CAAE,OAC/B,KAAM,CAAAC,EAAE,CAAG,GAAI,CAAAC,cAAc,CAACC,OAAO,EAAI,CACvC,IAAK,GAAI,CAAEC,WAAY,CAAC,EAAI,CAAAD,OAAO,CAAE,CACnCd,OAAO,CAAC,CACNC,KAAK,CAAGc,WAAW,CAACd,KAAK,CACzBC,MAAM,CAAEa,WAAW,CAACb,MACtB,CAAC,CAAC,CACJ,CACF,CAAC,CAAC,CACFU,EAAE,CAACI,OAAO,CAACnB,gBAAgB,CAACc,OAAO,CAAC,CACpC;AACA,KAAM,CAAEV,KAAK,CAAEC,MAAO,CAAC,CAAGL,gBAAgB,CAACc,OAAO,CAACM,qBAAqB,CAAC,CAAC,CAC1EjB,OAAO,CAAC,CAAEC,KAAK,CAAEC,MAAO,CAAC,CAAC,CAC1B,MAAO,IAAMU,EAAE,CAACM,UAAU,CAAC,CAAC,CAC9B,CAAC,CAAE,EAAE,CAAC,CAEN,KAAM,CAAAC,QAAQ,CAAGlC,OAAO,CAACmC,MAAM,CAC/B,KAAM,CAAAC,QAAQ,CAAG,EAAAvC,SAAA,CAAAG,OAAO,CAAC,CAAC,CAAC,UAAAH,SAAA,iBAAVA,SAAA,CAAYwC,QAAQ,CAACF,MAAM,GAAI,CAAC,CAEjD;AACA,KAAM,CAAAG,QAAQ,CAAGC,KAAA,EAAmB,KAAAC,gBAAA,IAAlB,CAAEC,SAAU,CAAC,CAAAF,KAAA,CAC7B,CAAAC,gBAAA,CAAA3B,OAAO,CAACa,OAAO,UAAAc,gBAAA,iBAAfA,gBAAA,CAAiBE,QAAQ,CAACD,SAAS,CAAC,CACtC,CAAC,CAED;AACA,KAAM,CAAAE,IAAI,CAAGrF,WAAW,CAACsF,KAAA,EAAsC,IAArC,CAAEC,WAAW,CAAEC,QAAQ,CAAEC,KAAM,CAAC,CAAAH,KAAA,CACxD,KAAM,CAAAI,IAAI,CAAKhD,OAAO,CAAC8C,QAAQ,CAAC,CAACT,QAAQ,CAACQ,WAAW,CAAC,CACtD,KAAM,CAAAI,MAAM,CAAG5E,aAAa,CAAC2E,IAAI,CAACE,WAAW,CAAC,CAAC,CAAC,EAAI,UAAU,CAC9D,KAAM,CAAAC,gBAAgB,CAAIjC,UAAU,GAAK2B,WAAW,CACpD;AACA,KAAM,CAAAO,iBAAiB,CACrB5C,eAAe,GAAKqC,WAAW,EAC/BtC,QAAQ,GAAKE,eAAe,CAE9B,mBACEzC,IAAA,QACE+E,KAAK,CAAEA,KAAM,CACbM,SAAS,4DAAAC,MAAA,CAELL,MAAM,iBAAAK,MAAA,CACNH,gBAAgB,EAAIC,iBAAiB,CAAG,qBAAqB,CAAG,EAAE,cACpE,CACFG,YAAY,CAAEC,CAAC,EAAI,CACjBrC,aAAa,CAAC0B,WAAW,CAAC,CAC1BnC,WAAW,CAACmC,WAAW,CAAE/C,EAAE,CAAC,CAC5B,KAAM,CAAA2D,IAAI,CAAG9C,YAAY,CAACe,OAAO,CAACM,qBAAqB,CAAC,CAAC,CACzDX,aAAa,CAAC,CAAEC,CAAC,CAAEkC,CAAC,CAACE,OAAO,CAAGD,IAAI,CAACE,IAAI,CAAEpC,CAAC,CAAEiC,CAAC,CAACI,OAAO,CAAGH,IAAI,CAACI,GAAI,CAAC,CAAC,CACtE,CAAE,CACFC,WAAW,CAAEN,CAAC,EAAI,CAChB,KAAM,CAAAC,IAAI,CAAG9C,YAAY,CAACe,OAAO,CAACM,qBAAqB,CAAC,CAAC,CACzDX,aAAa,CAAC,CAAEC,CAAC,CAAEkC,CAAC,CAACE,OAAO,CAAGD,IAAI,CAACE,IAAI,CAAEpC,CAAC,CAAEiC,CAAC,CAACI,OAAO,CAAGH,IAAI,CAACI,GAAI,CAAC,CAAC,CACtE,CAAE,CACFE,YAAY,CAAEA,CAAA,GAAM,CAClB5C,aAAa,CAAC,IAAI,CAAC,CACnBT,WAAW,CAAC,IAAI,CAAEZ,EAAE,CAAC,CACvB,CAAE,CACFkE,KAAK,QAAAV,MAAA,CAAST,WAAW,CAAG,CAAC,OAAAS,MAAA,CAAKN,IAAI,CAAG,CAAAiB,QAAA,CAExCjB,IAAI,CACF,CAAC,CAEV,CAAC,CAAE,CACDhD,OAAO,CAAEkB,UAAU,CACnBV,eAAe,CAAEC,eAAe,CAChCF,QAAQ,CAAET,EAAE,CAAEY,WAAW,CAC1B,CAAC,CAEF,mBACExC,KAAA,QACEgG,GAAG,CAAEvD,YAAa,CAClB0C,SAAS,CAAC,uDAAuD,CACjEU,YAAY,CAAEA,CAAA,GAAM,CAClB5C,aAAa,CAAC,IAAI,CAAC,CACnBT,WAAW,CAAC,IAAI,CAAEZ,EAAE,CAAC,CACvB,CAAE,CACFqE,aAAa,CAAEA,CAAA,GAAMhE,UAAU,CAACL,EAAE,CAAE,CAAAmE,QAAA,eAGpC/F,KAAA,QAAKmF,SAAS,CAAC,+FAA+F,CAAAY,QAAA,EAAC,OACxG,CAAChE,QAAQ,cACdjC,IAAA,WACEoG,OAAO,CAAEA,CAAA,GAAMlE,QAAQ,CAACJ,EAAE,CAAE,CAC5BuD,SAAS,CAAC,yDAAyD,CAAAY,QAAA,CACpE,MAAC,CAAQ,CAAC,cACXjG,IAAA,WACEoG,OAAO,CAAEA,CAAA,GAAMhE,WAAW,CAACN,EAAE,CAAE,CAC/BuD,SAAS,+CAAAC,MAAA,CACPjD,gBAAgB,CAAG,eAAe,CAClCC,QAAQ,CAAS,gBAAgB,CACf,eAAe,CAChC,CACH0D,KAAK,CAAE1D,QAAQ,CAAG,eAAe,CAAG,iBAAkB,CAAA2D,QAAA,CACvD,cAAE,CAAQ,CAAC,EACT,CAAC,CAGL/C,UAAU,GAAK,IAAI,eAClBhD,KAAA,QACEmF,SAAS,CAAC,4FAA4F,CACtGN,KAAK,CAAE,CAAEc,GAAG,CAAEzC,UAAU,CAACG,CAAC,CAAG,EAAE,CAAEoC,IAAI,CAAEvC,UAAU,CAACE,CAAC,CAAG,CAAE,CAAE,CAAA2C,QAAA,EAC3D,OACM,CAAC/C,UAAU,CAAG,CAAC,EACjB,CACN,cAGDhD,KAAA,QACEgG,GAAG,CAAEtD,gBAAiB,CACtByC,SAAS,CAAC,+CAA+C,CAAAY,QAAA,eAGzDjG,IAAA,CAACL,IAAI,EACHuG,GAAG,CAAErD,OAAQ,CACbI,MAAM,CAAEH,IAAI,CAACG,MAAO,CACpBD,KAAK,CAAEQ,WAAY,CACnB6C,SAAS,CAAEnC,QAAS,CACpBoC,QAAQ,CAAE7C,SAAU,CAAAwC,QAAA,CAEnBM,KAAA,EAAsB,IAArB,CAAEC,KAAK,CAAEzB,KAAM,CAAC,CAAAwB,KAAA,CAChB,KAAM,CAAAE,KAAK,CAAGzE,OAAO,CAACwE,KAAK,CAAC,CAAC1E,EAAE,CAAC4E,OAAO,CAAC,MAAM,CAAE,GAAG,CAAC,CAACC,IAAI,CAAC,CAAC,CAC3D,mBACE3G,IAAA,QACE+E,KAAK,CAAEA,KAAM,CACbM,SAAS,CAAC,oEAAoE,CAC9EW,KAAK,CAAES,KAAM,CAAAR,QAAA,CAEZQ,KAAK,CACH,CAAC,CAEV,CAAC,CACG,CAAC,cAGPzG,IAAA,CAACP,IAAI,EACHmH,WAAW,CAAExC,QAAS,CACtByC,WAAW,CAAEpD,SAAU,CACvBR,MAAM,CAAEH,IAAI,CAACG,MAAO,CACpBiB,QAAQ,CAAEA,QAAS,CACnB4C,SAAS,CAAErD,SAAU,CACrBT,KAAK,CAAE+D,IAAI,CAACC,GAAG,CAAClE,IAAI,CAACE,KAAK,CAAGQ,WAAW,CAAE,CAAC,CAAE,CAC7Cc,QAAQ,CAAEA,QAAS,CAAA2B,QAAA,CAElBtB,IAAI,CACD,CAAC,EACJ,CAAC,EACH,CAAC,CAEV,CAAC,CAAC,CAEF,KAAM,CAAAsC,SAAS,cAAG/H,KAAK,CAACyC,IAAI,CAAC,QAAS,CAAAsF,SAASA,CAAAC,KAAA,CAAkD,IAAjD,CAAEpF,EAAE,CAAEC,IAAI,CAAEG,QAAQ,CAAEC,UAAU,CAAEgF,WAAY,CAAC,CAAAD,KAAA,CAC7F,KAAM,CAAEnF,IAAI,CAAEqF,MAAM,CAAEnF,QAAQ,CAAEoF,KAAM,CAAC,CAAGtF,IAAI,CAE9C,mBACE7B,KAAA,QACEmF,SAAS,CAAC,8DAA8D,CACxEc,aAAa,CAAEA,CAAA,GAAMhE,UAAU,CAACL,EAAE,CAAE,CAAAmE,QAAA,eAEpC/F,KAAA,QAAKmF,SAAS,CAAC,+FAA+F,CAAAY,QAAA,EAAC,QACvG,CAAChE,QAAQ,cACfjC,IAAA,WACEoG,OAAO,CAAEA,CAAA,GAAMlE,QAAQ,CAACJ,EAAE,CAAE,CAC5BuD,SAAS,CAAC,wDAAwD,CAAAY,QAAA,CACnE,MAED,CAAQ,CAAC,EACN,CAAC,cACNjG,IAAA,QAAKqF,SAAS,CAAC,uDAAuD,CAAAY,QAAA,cACpEjG,IAAA,CAACH,eAAe,EAACuH,MAAM,CAAEA,MAAO,CAACC,KAAK,CAAEA,KAAM,CAACF,WAAW,CAAEA,WAAY,CAAE,CAAC,CACxE,CAAC,EACH,CAAC,CAEV,CAAC,CAAC,CAGF,KAAM,CAAAG,cAAc,cAAGpI,KAAK,CAACyC,IAAI,CAAC,QAAS,CAAA2F,cAAcA,CAAAC,KAAA,CAEN,IAFO,CAAEzF,EAAE,CAAEC,IAAI,CAAEG,QAAQ,CAAEC,UAAU,CACxFC,WAAW,CAAEC,gBAAgB,CAAEC,QAAQ,CAAEC,QAAQ,CACjDC,eAAe,CAAEC,eAAe,CAAEC,WAAY,CAAC,CAAA6E,KAAA,CAC/C,KAAM,CAAEtF,QAAS,CAAC,CAAGF,IAAI,CACzB,KAAM,CAAAyF,SAAS,CAAG,CAACC,KAAK,CAACC,OAAO,CAAC3F,IAAI,CAACA,IAAI,CAAC,CAC3C,KAAM,CAAC4F,WAAW,CAAEC,cAAc,CAAC,CAAGzI,QAAQ,CAC5CqI,SAAS,CAAGzF,IAAI,CAACA,IAAI,CAAC8F,OAAO,CAACC,IAAI,CAACC,CAAC,EAAI,MAAO,CAAAhG,IAAI,CAACA,IAAI,CAACiG,IAAI,CAAC,CAAC,CAAC,CAACD,CAAC,CAAC,GAAK,QAAQ,CAAC,CAAG,IACtF,CAAC,CACD,KAAM,CAAAE,WAAW,CAAGT,SAAS,CACzBzF,IAAI,CAACA,IAAI,CAAC8F,OAAO,CAACK,MAAM,CAACH,CAAC,EACxBhG,IAAI,CAACA,IAAI,CAACiG,IAAI,CAACG,KAAK,CAACC,GAAG,EAAI,MAAO,CAAAA,GAAG,CAACL,CAAC,CAAC,GAAK,QAAQ,CACxD,CAAC,CACD,EAAE,CACN,KAAM,CAAAM,YAAY,CAAGb,SAAS,EAAIG,WAAW,CACzC5F,IAAI,CAACA,IAAI,CAACiG,IAAI,CAACM,GAAG,CAACF,GAAG,EAAIA,GAAG,CAACT,WAAW,CAAC,CAAC,CAC3C,CAACH,SAAS,CACRzF,IAAI,CAACA,IAAI,CACT,EAAE,CAER,KAAM,CAAAwG,iBAAiB,CAAGnJ,MAAM,CAAC,IAAI,CAAC,CACtC,KAAM,CAAC6D,MAAM,CAAEuF,SAAS,CAAC,CAAGrJ,QAAQ,CAAC,GAAG,CAAC,CAAE;AAE3CE,SAAS,CAAC,IAAM,CACd,GAAI,CAACkJ,iBAAiB,CAAC7E,OAAO,CAAE,OAChC,KAAM,CAAA+E,YAAY,CAAGA,CAAA,GAAM,CACzBD,SAAS,CAACD,iBAAiB,CAAC7E,OAAO,CAACgF,YAAY,CAAC,CACnD,CAAC,CACDD,YAAY,CAAC,CAAC,CACd,KAAM,CAAA9E,EAAE,CAAG,GAAI,CAAAgF,MAAM,CAAC/E,cAAc,CAAC6E,YAAY,CAAC,CAClD9E,EAAE,CAACI,OAAO,CAACwE,iBAAiB,CAAC7E,OAAO,CAAC,CACrC,MAAO,IAAMC,EAAE,CAACM,UAAU,CAAC,CAAC,CAC9B,CAAC,CAAE,EAAE,CAAC,CACR;AACE,mBACE/D,KAAA,QACEmF,SAAS,CAAC,8DAA8D,CACxEc,aAAa,CAAEA,CAAA,GAAMhE,UAAU,CAACL,EAAE,CAAE,CAAAmE,QAAA,eAEpC/F,KAAA,QAAKmF,SAAS,CAAC,+FAA+F,CAAAY,QAAA,EAAC,QACvG,CAAChE,QAAQ,cACfjC,IAAA,WACEoG,OAAO,CAAEA,CAAA,GAAMlE,QAAQ,CAACJ,EAAE,CAAE,CAC5BuD,SAAS,CAAC,yDAAyD,CAAAY,QAAA,CACpE,MAED,CAAQ,CAAC,cACTjG,IAAA,WACEoG,OAAO,CAAEA,CAAA,GAAMhE,WAAW,CAACN,EAAE,CAAE,CAC/BuD,SAAS,+CAAAC,MAAA,CAAgDjD,gBAAgB,CAAG,eAAe,CAAGC,QAAQ,CAAG,gBAAgB,CAAG,eAAe,CAAG,CAC9I0D,KAAK,CAAE1D,QAAQ,CAAG,eAAe,CAAG,iBAAkB,CAAA2D,QAAA,CACvD,cAED,CAAQ,CAAC,EACN,CAAC,cACNjG,IAAA,QAAKqF,SAAS,CAAC,KAAK,CAAAY,QAAA,CACjBuB,SAAS,eACRtH,KAAA,CAAAE,SAAA,EAAA6F,QAAA,eACEjG,IAAA,UAAOqF,SAAS,CAAC,MAAM,CAAAY,QAAA,CAAC,gBAAc,CAAO,CAAC,cAC9CjG,IAAA,WACE4I,KAAK,CAAEjB,WAAY,CACnBkB,QAAQ,CAAErD,CAAC,EAAIoC,cAAc,CAACpC,CAAC,CAACsD,MAAM,CAACF,KAAK,CAAE,CAC9CvD,SAAS,CAAC,oBAAoB,CAAAY,QAAA,CAE7BgC,WAAW,CAACK,GAAG,CAACS,GAAG,eAClB/I,IAAA,WAAkB4I,KAAK,CAAEG,GAAI,CAAA9C,QAAA,CAAE8C,GAAG,EAArBA,GAA8B,CAC5C,CAAC,CACI,CAAC,EACT,CACH,CACE,CAAC,cACN/I,IAAA,QAAKkG,GAAG,CAAEqC,iBAAkB,CAAClD,SAAS,CAAC,gDAAgD,CAAAY,QAAA,cAC3FjG,IAAA,CAACF,SAAS,EACRkJ,MAAM,CAAEX,YAAa,CACrBY,OAAO,CAAEnH,EAAG,CACZY,WAAW,CAAEA,WAAY,CACzBF,eAAe,CAAEA,eAAgB,CACjCC,eAAe,CAAEA,eAAgB,CACjCF,QAAQ,CAAEA,QAAS,CACnBU,MAAM,CAAEA,MAAO,CAChB,CAAC,CACC,CAAC,EACG,CAAC,CAEV,CAAC,CAAC,CAEF,QAAS,CAAAiG,GAAGA,CAAA,CAAG,CACb,KAAM,CAACC,MAAM,CAAEC,SAAS,CAAC,CAAGjK,QAAQ,CAAC,EAAE,CAAC,CACxC,KAAM,CAACkK,MAAM,CAAEC,SAAS,CAAC,CAAGnK,QAAQ,CAAC,EAAE,CAAC,CACxC,KAAM,CAACoK,UAAU,CAAEC,aAAa,CAAC,CAAGrK,QAAQ,CAAC,IAAI,CAAC,CAClD,KAAM,CAACsK,QAAQ,CAAEC,WAAW,CAAC,CAAGvK,QAAQ,CAAC,IAAI,CAAC,CAC9C,KAAM,CAACwK,UAAU,CAAEC,aAAa,CAAC,CAAGzK,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAE;AAClD,KAAM,CAAC0K,aAAa,CAAEC,gBAAgB,CAAC,CAAG3K,QAAQ,CAAC,IAAI,CAAC,CACxD,KAAM,CAACsD,eAAe,CAAEsH,kBAAkB,CAAC,CAAG5K,QAAQ,CAAC,IAAI,CAAC,CAC5D,KAAM,CAAC6K,SAAS,CAAEC,YAAY,CAAC,CAAG9K,QAAQ,CAAC,CAAC,CAAC,CAAC,CAC9C,KAAM,CAAA+K,YAAY,CAAG9K,MAAM,CAAC,IAAI,CAAC,CACjC,KAAM,CAAA+K,cAAc,CAAG/K,MAAM,CAAC,IAAI,CAAC,CACnC,KAAM,CAAAgL,eAAe,CAAGhL,MAAM,CAAC,IAAI,CAAC,CACpC,KAAM,CAACiL,WAAW,CAAEC,cAAc,CAAC,CAAGnL,QAAQ,CAACwJ,MAAM,CAAC4B,UAAU,CAAC,CACjE,KAAM,CAACC,QAAQ,CAAEC,WAAW,CAAC,CAAGtL,QAAQ,CAAC,KAAK,CAAC,CAE/CE,SAAS,CAAC,IAAM,CACd,KAAM,CAAAqL,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,UAAU,CAAC,CAC9C,GAAIF,KAAK,GAAK,IAAI,CAAED,WAAW,CAACC,KAAK,GAAK,MAAM,CAAC,CACnD,CAAC,CAAE,EAAE,CAAC,CAENrL,SAAS,CAAC,IAAM,CACdwL,QAAQ,CAACC,eAAe,CAACC,SAAS,CAACC,MAAM,CAAC,MAAM,CAAER,QAAQ,CAAC,CAC3DG,YAAY,CAACM,OAAO,CAAC,UAAU,CAAET,QAAQ,CAAC,CAC5C,CAAC,CAAE,CAACA,QAAQ,CAAC,CAAC,CAEdnL,SAAS,CAAC,IAAM,CACd,KAAM,CAAAoJ,YAAY,CAAGA,CAAA,GAAM6B,cAAc,CAAC3B,MAAM,CAAC4B,UAAU,CAAC,CAC5D5B,MAAM,CAACuC,gBAAgB,CAAC,QAAQ,CAAEzC,YAAY,CAAC,CAC/C,MAAO,IAAME,MAAM,CAACwC,mBAAmB,CAAC,QAAQ,CAAE1C,YAAY,CAAC,CACjE,CAAC,CAAE,EAAE,CAAC,CAGN,KAAM,CAAA2C,eAAe,CAAItJ,EAAE,EAAK,CAC9B,GAAI,CAAC2H,QAAQ,CAAE,CACb;AACA,GAAIE,UAAU,CAAC7H,EAAE,CAAC,CAAE,CAClB;AACA,KAAM,CAAAuJ,KAAK,CAAG1B,UAAU,CAAC7H,EAAE,CAAC,CAC5B8H,aAAa,CAAC0B,EAAE,EAAI,CAClB,KAAM,CAAAC,IAAI,CAAAC,aAAA,IAAQF,EAAE,CAAE,CACtB,MAAO,CAAAC,IAAI,CAACzJ,EAAE,CAAC,CAAE,MAAO,CAAAyJ,IAAI,CAACF,KAAK,CAAC,CACnC,MAAO,CAAAE,IAAI,CACb,CAAC,CAAC,CACJ,CAAC,IAAM,CACL;AACA7B,WAAW,CAAC5H,EAAE,CAAC,CACjB,CACF,CAAC,IAAM,CACL;AACA,GAAI2H,QAAQ,GAAK3H,EAAE,CAAE,CACnB;AACA4H,WAAW,CAAC,IAAI,CAAC,CACnB,CAAC,IAAM,CACL;AACA,KAAM,CAAA+B,CAAC,CAAGhC,QAAQ,CAClB,KAAM,CAAAiC,CAAC,CAAG5J,EAAE,CACZ,GAAI6H,UAAU,CAAC8B,CAAC,CAAC,GAAKC,CAAC,CAAE,CACvB;AACA9B,aAAa,CAAC0B,EAAE,EAAI,CAClB,KAAM,CAAAC,IAAI,CAAAC,aAAA,IAAQF,EAAE,CAAE,CACtB,MAAO,CAAAC,IAAI,CAACE,CAAC,CAAC,CAAE,MAAO,CAAAF,IAAI,CAACG,CAAC,CAAC,CAC9B,MAAO,CAAAH,IAAI,CACb,CAAC,CAAC,CACJ,CAAC,IAAM,CACL;AACA3B,aAAa,CAAC0B,EAAE,EAAI,CAClB,KAAM,CAAAC,IAAI,CAAAC,aAAA,IAAQF,EAAE,CAAE,CACtB,GAAIC,IAAI,CAACE,CAAC,CAAC,CAAE,CAAE,MAAO,CAAAF,IAAI,CAACE,CAAC,CAAC,CAAE,MAAO,CAAAF,IAAI,CAACA,IAAI,CAACE,CAAC,CAAC,CAAC,CAAE,CACrD,GAAIF,IAAI,CAACG,CAAC,CAAC,CAAE,CAAE,MAAO,CAAAH,IAAI,CAACG,CAAC,CAAC,CAAE,MAAO,CAAAH,IAAI,CAACA,IAAI,CAACG,CAAC,CAAC,CAAC,CAAE,CACrDH,IAAI,CAACE,CAAC,CAAC,CAAGC,CAAC,CACXH,IAAI,CAACG,CAAC,CAAC,CAAGD,CAAC,CACX,MAAO,CAAAF,IAAI,CACb,CAAC,CAAC,CACJ,CACA7B,WAAW,CAAC,IAAI,CAAC,CACnB,CACF,CACA;AACAI,gBAAgB,CAAC,IAAI,CAAC,CACtBC,kBAAkB,CAAC,IAAI,CAAC,CAC1B,CAAC,CAED,KAAM,CAAA4B,eAAe,CAAGA,CAACC,IAAI,CAAEC,QAAQ,GAAK,CAC1C/B,gBAAgB,CAAC8B,IAAI,CAAC,CACtB7B,kBAAkB,CAAC8B,QAAQ,CAAC,CAC9B,CAAC,CAGD;AACA,KAAM,CAAAC,aAAa,CAAG,QAAAA,CAACC,IAAI,CAAqB,IAAnB,CAAA9C,OAAO,CAAA+C,SAAA,CAAA7H,MAAA,IAAA6H,SAAA,MAAAC,SAAA,CAAAD,SAAA,IAAG,IAAI,CACzC7B,cAAc,CAACzG,OAAO,CAAGqI,IAAI,CAC7B3B,eAAe,CAAC1G,OAAO,CAAGuF,OAAO,CACjC,GAAIiB,YAAY,CAACxG,OAAO,CAAEwG,YAAY,CAACxG,OAAO,CAACwI,KAAK,CAAC,CAAC,CACxD,CAAC,CAED,KAAM,CAAAC,gBAAgB,CAAG,KAAO,CAAA3G,CAAC,EAAK,CACpC,KAAM,CAAA4G,IAAI,CAAG5G,CAAC,CAACsD,MAAM,CAACuD,KAAK,CAAC,CAAC,CAAC,CAC9B,GAAI,CAACD,IAAI,CAAE,OAEX,KAAM,CAAAL,IAAI,CAAG5B,cAAc,CAACzG,OAAO,CACnC,KAAM,CAAA4I,UAAU,CAAGC,OAAO,CAACnC,eAAe,CAAC1G,OAAO,CAAC,CACnD,KAAM,CAAA5B,EAAE,CAAGwK,UAAU,CAAGlC,eAAe,CAAC1G,OAAO,IAAA4B,MAAA,CAAMyG,IAAI,MAAAzG,MAAA,CAAIkH,IAAI,CAACC,GAAG,CAAC,CAAC,CAAE,CACzE,KAAM,CAAAxK,QAAQ,CAAGmK,IAAI,CAACM,IAAI,CAE1B,GAAI,CAAAC,YAAY,CAChB,GAAIZ,IAAI,GAAK,WAAW,CAAE,CACxB,KAAM,CAAAa,QAAQ,CAAG,GAAI,CAAAC,QAAQ,CAAC,CAAC,CAC/BD,QAAQ,CAACE,MAAM,CAAC,MAAM,CAAEV,IAAI,CAAC,CAC7B,KAAM,CAAAW,GAAG,CAAG,KAAM,CAAAC,KAAK,CAAC,8BAA8B,CAAE,CAAEC,MAAM,CAAE,MAAM,CAAEC,IAAI,CAAEN,QAAS,CAAC,CAAC,CAC3F,KAAM,CAAA7K,IAAI,CAAG,KAAM,CAAAgL,GAAG,CAACI,IAAI,CAAC,CAAC,CAC7BR,YAAY,CAAG,CAAE5K,IAAI,CAAEE,QAAS,CAAC,CACnC,CAAC,IAAM,IAAI8J,IAAI,GAAK,MAAM,CAAE,CAC1B,KAAM,CAAAqB,IAAI,CAAG,KAAM,CAAAhB,IAAI,CAACgB,IAAI,CAAC,CAAC,CAC9B,KAAM,CAAA/F,KAAK,CAAG,SAAS,CAACgG,IAAI,CAACpL,QAAQ,CAAC,EAAImL,IAAI,CAACE,QAAQ,CAAC,QAAQ,CAAC,CACjE/N,KAAK,CAAC6N,IAAI,CAAC,CACXT,YAAY,CAAG,CAAE5K,IAAI,CAAEqL,IAAI,CAAEnL,QAAQ,CAAEoF,KAAM,CAAC,CAChD,CAAC,IAAM,IAAI0E,IAAI,GAAK,WAAW,CAAE,CAC/B,KAAM,CAAAqB,IAAI,CAAG,KAAM,CAAAhB,IAAI,CAACgB,IAAI,CAAC,CAAC,CAC9B,KAAM,CAAAG,KAAK,CAAGH,IAAI,CAACzG,IAAI,CAAC,CAAC,CAAC6G,KAAK,CAAC,OAAO,CAAC,CACxC,GAAIvL,QAAQ,CAACwL,WAAW,CAAC,CAAC,CAACC,QAAQ,CAAC,MAAM,CAAC,EAAIH,KAAK,CAAC,CAAC,CAAC,CAACD,QAAQ,CAAC,IAAI,CAAC,CAAE,CACtE,KAAM,CAAAzF,OAAO,CAAG0F,KAAK,CAAC,CAAC,CAAC,CAACC,KAAK,CAAC,IAAI,CAAC,CAAClF,GAAG,CAACP,CAAC,EAAIA,CAAC,CAACpB,IAAI,CAAC,CAAC,CAAC,CACvD,KAAM,CAAAqB,IAAI,CAAGuF,KAAK,CAACI,KAAK,CAAC,CAAC,CAAC,CAACrF,GAAG,CAACsF,IAAI,EAAI,CACtC,KAAM,CAAAC,IAAI,CAAGD,IAAI,CAACJ,KAAK,CAAC,IAAI,CAAC,CAC7B,KAAM,CAAAM,GAAG,CAAG,CAAC,CAAC,CACdjG,OAAO,CAACkG,OAAO,CAAC,CAAChG,CAAC,CAAEiG,CAAC,GAAK,KAAAC,OAAA,CACxB,KAAM,CAAAC,CAAC,EAAAD,OAAA,CAAGJ,IAAI,CAACG,CAAC,CAAC,UAAAC,OAAA,iBAAPA,OAAA,CAAStH,IAAI,CAAC,CAAC,CACzB,KAAM,CAAAwH,CAAC,CAAGC,MAAM,CAACF,CAAC,CAAC,CACnBJ,GAAG,CAAC/F,CAAC,CAAC,CAAGsG,KAAK,CAACF,CAAC,CAAC,CAAGD,CAAC,CAAGC,CAAC,CAC3B,CAAC,CAAC,CACF,MAAO,CAAAL,GAAG,CACZ,CAAC,CAAC,CACFnB,YAAY,CAAG,CAAE5K,IAAI,CAAE,CAAE8F,OAAO,CAAEG,IAAK,CAAC,CAAE/F,QAAS,CAAC,CACtD,CAAC,IAAM,CACL,KAAM,CAAA+G,MAAM,CAAGoE,IAAI,CAACzG,IAAI,CAAC,CAAC,CAAC6G,KAAK,CAAC,KAAK,CAAC,CAAClF,GAAG,CAAC8F,MAAM,CAAC,CAAClG,MAAM,CAACiG,CAAC,EAAI,CAACE,KAAK,CAACF,CAAC,CAAC,CAAC,CAC1ExB,YAAY,CAAG,CAAE5K,IAAI,CAAEiH,MAAM,CAAE/G,QAAS,CAAC,CAC3C,CACF,CAEA;AACAgI,YAAY,CAACqE,IAAI,EAAA9C,aAAA,CAAAA,aAAA,IAAU8C,IAAI,MAAE,CAACxM,EAAE,EAAG6K,YAAY,EAAG,CAAC,CAEvD,GAAI,CAACL,UAAU,CAAE,CACf;AACAlD,SAAS,CAACkF,IAAI,EAAI,CAChB,KAAM,CAAAC,aAAa,CAAGD,IAAI,CAACpG,MAAM,CAACsG,CAAC,EAAIA,CAAC,CAACR,CAAC,GAAK,UAAU,CAAC,CAC1D,MAAO,CACL,GAAGO,aAAa,CAChB,CAAEP,CAAC,CAAElM,EAAE,CAAEiK,IAAK,CAAC,CACf,CAAEiC,CAAC,CAAE,UAAU,CAAEjC,IAAI,CAAE,QAAS,CAAC,CAClC,CACH,CAAC,CAAC,CACF,KAAM,CAAA0C,mBAAmB,CAAGpF,MAAM,CAACnB,MAAM,CAACwG,CAAC,EAAIA,CAAC,CAACV,CAAC,GAAK,UAAU,CAAC,CAClE,KAAM,CAAAW,IAAI,CAAGF,mBAAmB,CAACG,MAAM,CAAC,CAAC5H,GAAG,CAAE0H,CAAC,GAAK3H,IAAI,CAACC,GAAG,CAACA,GAAG,CAAE0H,CAAC,CAACnL,CAAC,CAAGmL,CAAC,CAAC3G,CAAC,CAAC,CAAE,CAAC,CAAC,CAChF,KAAM,CAAA8G,cAAc,CAAG,CAAEb,CAAC,CAAElM,EAAE,CAAEwB,CAAC,CAAGmL,mBAAmB,CAACtK,MAAM,CAAG,CAAC,CAAI,EAAE,CAAEZ,CAAC,CAAEoL,IAAI,CAAEG,CAAC,CAAE,CAAC,CAAE/G,CAAC,CAAE,EAAE,CAAEgH,IAAI,CAAE,CAAC,CAAEC,IAAI,CAAE,CAAE,CAAC,CAClH1F,SAAS,CAAC,CAAC,GAAGmF,mBAAmB,CAAEI,cAAc,CAAE,CAAEb,CAAC,CAAE,UAAU,CAAE1K,CAAC,CAAE,CAAC,CAAEC,CAAC,CAAEoL,IAAI,CAAG,CAAC,CAAEG,CAAC,CAAE,EAAE,CAAE/G,CAAC,CAAE,CAAC,CAAEkH,MAAM,CAAE,IAAK,CAAC,CAAC,CAAC,CACtH,CAEA;AACA9E,cAAc,CAACzG,OAAO,CAAG,IAAI,CAC7B0G,eAAe,CAAC1G,OAAO,CAAG,IAAI,CAC9B,GAAIwG,YAAY,CAACxG,OAAO,CAAEwG,YAAY,CAACxG,OAAO,CAACkF,KAAK,CAAG,IAAI,CAC7D,CAAC,CAED,KAAM,CAAAsG,WAAW,CAAIpN,EAAE,EAAK,CAC1B,GAAIA,EAAE,GAAK,UAAU,CAAE,OACvBsH,SAAS,CAACoF,CAAC,EAAIA,CAAC,CAACtG,MAAM,CAACiH,KAAK,EAAIA,KAAK,CAACnB,CAAC,GAAKlM,EAAE,CAAC,CAAC,CACjDmI,YAAY,CAACmF,CAAC,EAAI,CAAE,KAAM,CAAAC,CAAC,CAAA7D,aAAA,IAAQ4D,CAAC,CAAE,CAAE,MAAO,CAAAC,CAAC,CAACvN,EAAE,CAAC,CAAE,MAAO,CAAAuN,CAAC,CAAE,CAAC,CAAC,CAClE/F,SAAS,CAACoF,CAAC,EAAIA,CAAC,CAACxG,MAAM,CAACoH,KAAK,EAAIA,KAAK,CAACtB,CAAC,GAAKlM,EAAE,CAAC,CAAC,CACnD,CAAC,CAED,mBACE5B,KAAA,QAAKmF,SAAS,CAAC,sGAAsG,CAAAY,QAAA,eACnH/F,KAAA,QAAKmF,SAAS,CAAC,uCAAuC,CAAAY,QAAA,eACpDjG,IAAA,QAAKqF,SAAS,CAAC,wCAAwC,CAAAY,QAAA,CACpD,UAAU,CAACuH,KAAK,CAAC,EAAE,CAAC,CAAClF,GAAG,CAAC,CAACtD,IAAI,CAAEgJ,CAAC,gBAChChO,IAAA,SAAcqF,SAAS,+EAAAC,MAAA,CAAgFjF,aAAa,CAAC2E,IAAI,CAAC,KAAI,CAAAiB,QAAA,CAAEjB,IAAI,EAAzHgJ,CAAgI,CAC5I,CAAC,CACC,CAAC,cACN9N,KAAA,QAAKmF,SAAS,CAAC,yBAAyB,CAAAY,QAAA,eACtCjG,IAAA,WAAQoG,OAAO,CAAEA,CAAA,GAAM0F,aAAa,CAAC,WAAW,CAAE,CAACzG,SAAS,CAAC,8DAA8D,CAAAY,QAAA,CAAC,qBAE5H,CAAQ,CAAC,cACTjG,IAAA,WAAQoG,OAAO,CAAEA,CAAA,GAAM0F,aAAa,CAAC,MAAM,CAAE,CAACzG,SAAS,CAAC,4DAA4D,CAAAY,QAAA,CAAC,yBAErH,CAAQ,CAAC,cACTjG,IAAA,WAAQoG,OAAO,CAAEA,CAAA,GAAM0F,aAAa,CAAC,WAAW,CAAE,CAACzG,SAAS,CAAC,gEAAgE,CAAAY,QAAA,CAAC,yBAE9H,CAAQ,CAAC,cACTjG,IAAA,WAAQoG,OAAO,CAAEA,CAAA,GAAMqE,WAAW,CAAC6D,IAAI,EAAI,CAACA,IAAI,CAAE,CAACjJ,SAAS,CAAC,iHAAiH,CAAAY,QAAA,CAC3KuE,QAAQ,CAAG,IAAI,CAAG,GAAG,CAChB,CAAC,cACTxK,IAAA,UAAOkG,GAAG,CAAEgE,YAAa,CAAC6B,IAAI,CAAC,MAAM,CAACwD,MAAM,CAAC,iCAAiC,CAAC1G,QAAQ,CAAEsD,gBAAiB,CAACpH,KAAK,CAAE,CAAEyK,OAAO,CAAE,MAAO,CAAE,CAAE,CAAC,EACtI,CAAC,EACH,CAAC,CAELrG,MAAM,CAAChF,MAAM,CAAG,CAAC,eAChBnE,IAAA,QAAKqF,SAAS,CAAC,+BAA+B,CAAAY,QAAA,cAC5CjG,IAAA,CAACJ,UAAU,EACTyF,SAAS,CAAC,QAAQ,CAClBgE,MAAM,CAAEA,MAAO,CACfwE,IAAI,CAAE,EAAG,CACT/G,SAAS,CAAE,EAAG,CACd9D,KAAK,CAAEqH,WAAY,CACnBoF,QAAQ,CAAE,KAAM,CAChBC,WAAW,MACXC,WAAW,MACXC,MAAM,CAAE,CAAC,EAAE,CAAE,EAAE,CAAE,CACjBC,gBAAgB,CAAE,CAAC,EAAE,CAAE,EAAE,CAAE,CAC3BC,eAAe,CAAC,oBAAoB,CACpCC,eAAe,CAAC,yCAAyC,CACzDC,cAAc,CAAGC,SAAS,EAAK,CAC7B,KAAM,CAAAC,MAAM,CAAGD,SAAS,CAACnI,IAAI,CAAC4G,CAAC,EAAIA,CAAC,CAACV,CAAC,GAAK,UAAU,CAAC,CACtD,KAAM,CAAAmC,MAAM,CAAGF,SAAS,CAAC/H,MAAM,CAACwG,CAAC,EAAIA,CAAC,CAACV,CAAC,GAAK,UAAU,CAAC,CACxD,KAAM,CAAAW,IAAI,CAAGwB,MAAM,CAACvB,MAAM,CAAC,CAAC5H,GAAG,CAAE0H,CAAC,GAAK3H,IAAI,CAACC,GAAG,CAACA,GAAG,CAAE0H,CAAC,CAACnL,CAAC,CAAGmL,CAAC,CAAC3G,CAAC,CAAC,CAAE,CAAC,CAAC,CACnE,KAAM,CAAAqI,WAAW,CAAA5E,aAAA,CAAAA,aAAA,IAAQ0E,MAAM,MAAE3M,CAAC,CAAEoL,IAAI,EAAE,CAC1CrF,SAAS,CAAC,CAAC,GAAG6G,MAAM,CAAEC,WAAW,CAAC,CAAC,CACrC,CAAE,CAAAnK,QAAA,CAEbkD,MAAM,CAACb,GAAG,CAAC6G,KAAK,EAAI,CACnB,GAAIA,KAAK,CAACnB,CAAC,GAAK,UAAU,CAAE,CAC1B,mBACEhO,IAAA,QAAoBqF,SAAS,CAAC,2EAA2E,EAAhG,UAAkG,CAAC,CAEhH,CACA,KAAM,CAAAtD,IAAI,CAAGiI,SAAS,CAACmF,KAAK,CAACnB,CAAC,CAAC,CAC/B,GAAI,CAACjM,IAAI,CAAE,MAAO,KAAI,CAEtB,KAAM,CAAAsO,WAAW,CAAG,CAClBvO,EAAE,CAAEqN,KAAK,CAACnB,CAAC,CACXjM,IAAI,CACJG,QAAQ,CAAEgN,WAAW,CACrB/M,UAAU,CAAEL,EAAE,EAAIgK,aAAa,CAACqD,KAAK,CAACpD,IAAI,CAAEjK,EAAE,CAAC,CAE/CM,WAAW,CAAEgJ,eAAe,CAC5B/I,gBAAgB,CAAEoH,QAAQ,GAAK0F,KAAK,CAACnB,CAAC,CACtC1L,QAAQ,CAAE,CAAC,CAACqH,UAAU,CAACwF,KAAK,CAACnB,CAAC,CAAC,CAC/BzL,QAAQ,CAAEoH,UAAU,CAACwF,KAAK,CAACnB,CAAC,CAAC,EAAI,IAAI,CAErCxL,eAAe,CAAEqH,aAAa,CAC9BpH,eAAe,CAAEA,eAAe,CAChCC,WAAW,CAAEiJ,eACf,CAAC,CAED,mBACE3L,IAAA,QAAAiG,QAAA,CACGkJ,KAAK,CAACpD,IAAI,GAAK,WAAW,cACzB/L,IAAA,CAAC0B,cAAc,CAAA8J,aAAA,CAAAA,aAAA,IACT6E,WAAW,MACf9G,UAAU,CAAEA,UAAW,EACxB,CAAC,CACA4F,KAAK,CAACpD,IAAI,GAAK,MAAM,cACvB/L,IAAA,CAACiH,SAAS,CAAAuE,aAAA,CAAAA,aAAA,IACJ6E,WAAW,MACflJ,WAAW,CAAEqC,aAAc,EAC5B,CAAC,cAEFxJ,IAAA,CAACsH,cAAc,CAAAkE,aAAA,IACT6E,WAAW,CAChB,CACF,EAfOlB,KAAK,CAACnB,CAgBX,CAAC,CAEV,CAAC,CAAC,CACoB,CAAC,CACV,CACN,EACE,CAAC,CAEV,CAEA,cAAe,CAAA9E,GAAG","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}